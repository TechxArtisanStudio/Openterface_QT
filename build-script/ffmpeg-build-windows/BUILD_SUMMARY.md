# FFmpeg Static Build Scripts - Summary

## ğŸ“¦ Created Files

I've created a complete set of scripts to build static FFmpeg libraries for your Windows project using MSYS2:

### Main Build Scripts
1. **`build-script/build-static-ffmpeg-windows.bat`**
   - Main Windows batch script
   - Automatically launches MSYS2 and runs the build
   - Use this from Windows Command Prompt

2. **`build-script/build-static-ffmpeg-windows.sh`**
   - Bash script for MSYS2 environment
   - Can be run directly from MSYS2 MinGW64 shell
   - Auto-generated by .bat file or use manually

### Documentation
3. **`build-script/ffmpeg-build-windows/README.md`**
   - Complete documentation
   - Troubleshooting guide
   - Advanced usage examples

4. **`build-script/ffmpeg-build-windows/QUICKSTART.md`**
   - Quick reference card
   - Common commands
   - Quick troubleshooting

### Utilities
5. **`build-script/verify-ffmpeg-installation.bat`**
   - Verification script
   - Checks if FFmpeg is properly installed
   - Provides next steps

## ğŸš€ How to Use

### Step 1: Run the Build
Open Command Prompt and run:
```cmd
cd E:\Openterface_QT\build-script
build-static-ffmpeg-windows.bat
```

### Step 2: Wait (30-60 minutes)
The script will:
- âœ… Check MSYS2 installation
- âœ… Install required packages
- âœ… Download FFmpeg 7.0.2 source
- âœ… Configure for static linking
- âœ… Compile with all CPU cores
- âœ… Install to `C:\ffmpeg-static`

### Step 3: Verify Installation
```cmd
verify-ffmpeg-installation.bat
```

### Step 4: Use in Your Project
```cmd
set FFMPEG_PREFIX=C:\ffmpeg-static
cmake -B build -S . -DFFMPEG_PREFIX=C:\ffmpeg-static
cmake --build build --config Release
```

## ğŸ“‹ What Gets Built

The build creates fully static FFmpeg libraries with:

### Libraries
- `libavcodec.a` - Audio/video codec library
- `libavformat.a` - Muxing/demuxing library
- `libavutil.a` - Utility library
- `libswresample.a` - Audio resampling library
- `libswscale.a` - Video scaling library
- `libavdevice.a` - Device handling library
- `libavfilter.a` - Filtering library
- `libpostproc.a` - Post-processing library

### Features Enabled
- âœ… Static linking (no DLL dependencies)
- âœ… GPL and version3 licenses
- âœ… Hardware acceleration (DXVA2, D3D11VA for Windows)
- âœ… Multi-threading support
- âœ… Network protocols
- âœ… Runtime CPU detection
- âœ… All core codecs

### Features Disabled
- âŒ Shared libraries
- âŒ FFmpeg command-line tools (not needed for library usage)
- âŒ Documentation

## ğŸ¯ Integration with Your Project

Your project's `cmake/FFmpeg.cmake` is already configured to use the `FFMPEG_PREFIX` variable. After building FFmpeg, it will automatically detect:

1. Include directories: `C:\ffmpeg-static\include`
2. Library directory: `C:\ffmpeg-static\lib`
3. Static libraries: All `.a` files

The CMake configuration will link them in the correct order for static linking.

## âš™ï¸ Configuration Options

You can customize the build by editing variables in the scripts:

### In `build-static-ffmpeg-windows.bat`:
```batch
set FFMPEG_VERSION=7.0.2
set FFMPEG_INSTALL_PREFIX=C:\ffmpeg-static
set MSYS2_ROOT=C:\msys64
```

### As Environment Variables (before running):
```cmd
set FFMPEG_VERSION=6.1.1
set FFMPEG_INSTALL_PREFIX=D:\my-ffmpeg
build-static-ffmpeg-windows.bat
```

## ğŸ” Technical Details

### Build Configuration
The FFmpeg configure command includes:
```bash
./configure \
    --prefix=/c/ffmpeg-static \
    --arch=x86_64 \
    --target-os=mingw32 \
    --disable-shared \
    --enable-static \
    --enable-gpl \
    --enable-version3 \
    --enable-dxva2 \
    --enable-d3d11va \
    --enable-runtime-cpudetect \
    --pkg-config-flags="--static" \
    --extra-ldflags="-static -static-libgcc -static-libstdc++"
```

### Why Static Linking?
- âœ… No DLL hell - everything embedded in your executable
- âœ… Easier distribution - single executable
- âœ… Version control - locked to specific FFmpeg version
- âœ… Better compatibility - works across different Windows versions

## ğŸ“Š Disk Space Requirements

- **During build**: ~5 GB (source + build files)
- **After build**: ~500 MB (installed libraries)
- **Can delete**: `ffmpeg-build-temp` directory (~3-4 GB) after successful build

## ğŸ› Troubleshooting

### Build fails immediately
- **Cause**: MSYS2 not found
- **Solution**: Install MSYS2 from https://www.msys2.org/

### Build fails during package installation
- **Cause**: No internet connection or MSYS2 needs update
- **Solution**: Open MSYS2 shell, run `pacman -Syu`

### Build fails during compilation
- **Cause**: Out of memory or disk space
- **Solution**: 
  - Reduce `NUM_CORES` in the script
  - Free up disk space (~5GB needed)

### CMake can't find FFmpeg
- **Cause**: `FFMPEG_PREFIX` not set
- **Solution**: `set FFMPEG_PREFIX=C:\ffmpeg-static`

## ğŸ“š Additional Resources

- **FFmpeg Documentation**: https://ffmpeg.org/documentation.html
- **MSYS2 Documentation**: https://www.msys2.org/docs/
- **Your Project FFmpeg Config**: `E:\Openterface_QT\cmake\FFmpeg.cmake`

## ğŸ‰ Success Indicators

After successful build, you should see:
1. Message: "âœ“ FFmpeg static libraries installed successfully!"
2. Directory `C:\ffmpeg-static\lib` contains *.a files
3. Directory `C:\ffmpeg-static\include` contains libav* subdirectories
4. `verify-ffmpeg-installation.bat` passes all checks

## ğŸ”„ Next Steps After Build

1. **Verify Installation**:
   ```cmd
   verify-ffmpeg-installation.bat
   ```

2. **Set Environment Variable**:
   ```cmd
   set FFMPEG_PREFIX=C:\ffmpeg-static
   ```

3. **Build Your Project**:
   ```cmd
   cd E:\Openterface_QT
   cmake -B build -S . -DFFMPEG_PREFIX=C:\ffmpeg-static
   cmake --build build --config Release
   ```

4. **Optional - Cleanup**:
   ```cmd
   rmdir /s /q ffmpeg-build-temp
   ```

## ğŸ“ License Note

The build uses `--enable-gpl`, making the resulting libraries GPL-licensed. Ensure your project complies with GPL requirements when using this build.

---

**Ready to build?** Just run:
```cmd
cd E:\Openterface_QT\build-script
build-static-ffmpeg-windows.bat
```

Then grab a coffee! â˜• The build takes 30-60 minutes.
